    <script>
        // Embedded data for fast loading - no external API calls needed
        const analysisData = {
            "executive_summary": {
                "total_daily_passengers": 2151000,
                "analyzed_stations": 5,
                "active_operators": 2,
                "railway_lines": 4,
                "average_delay_minutes": 1.0
            },
            "station_analysis": {
                "busiest_stations": [
                    {
                        "rank": 1,
                        "name_en": "Shinjuku Station",
                        "name_jp": "新宿駅",
                        "daily_passengers": 753000,
                        "operator": "JR-East",
                        "railway": "Yamanote",
                        "coordinates": {"lat": 35.6896, "lng": 139.7006}
                    },
                    {
                        "rank": 2,
                        "name_en": "Ikebukuro Station",
                        "name_jp": "池袋駅",
                        "daily_passengers": 558000,
                        "operator": "Tokyo Metro",
                        "railway": "Marunouchi",
                        "coordinates": {"lat": 35.7295, "lng": 139.7109}
                    },
                    {
                        "rank": 3,
                        "name_en": "Tokyo Station",
                        "name_jp": "東京駅",
                        "daily_passengers": 462000,
                        "operator": "JR-East",
                        "railway": "Yamanote",
                        "coordinates": {"lat": 35.6812, "lng": 139.7671}
                    },
                    {
                        "rank": 4,
                        "name_en": "Ueno Station",
                        "name_jp": "上野駅",
                        "daily_passengers": 198000,
                        "operator": "Tokyo Metro",
                        "railway": "Hibiya",
                        "coordinates": {"lat": 35.7148, "lng": 139.7774}
                    },
                    {
                        "rank": 5,
                        "name_en": "Ginza Station",
                        "name_jp": "銀座駅",
                        "daily_passengers": 180000,
                        "operator": "Tokyo Metro",
                        "railway": "Ginza",
                        "coordinates": {"lat": 35.6717, "lng": 139.7647}
                    }
                ],
                "operator_breakdown": {
                    "JR-East": {
                        "stations": 2,
                        "total_passengers": 1215000,
                        "percentage": 56.5
                    },
                    "Tokyo Metro": {
                        "stations": 3,
                        "total_passengers": 936000,
                        "percentage": 43.5
                    }
                }
            },
            "real_time_analysis": {
                "system_performance": {
                    "overall_punctuality": 94.2,
                    "average_delay": 1.0,
                    "on_time_percentage": 85.7,
                    "delayed_services": 2,
                    "cancelled_services": 0,
                    "service_availability": 99.8
                }
            }
        };

        let map = null, passengerChart = null, operatorChart = null;

        function initDashboard() {
            console.log('🚀 Initializing dashboard...');
            updateTime();
            updateMetrics();
            populateStationList();
            createOperatorChart();
            createPassengerChart();
            initMap();
            setInterval(updateTime, 1000);
            console.log('✅ Dashboard initialized successfully!');
        }

        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('en-US', {hour12: false, timeZone: 'Asia/Tokyo'}) + ' JST';
            }
        }

        function updateMetrics() {
            const summary = analysisData.executive_summary;
            const performance = analysisData.real_time_analysis?.system_performance;
            
            document.getElementById('total-passengers').textContent = summary.total_daily_passengers.toLocaleString();
            document.getElementById('punctuality').textContent = performance.overall_punctuality + '%';
            document.getElementById('avg-delay').textContent = performance.average_delay;
            document.getElementById('active-alerts').textContent = performance.cancelled_services;
        }

        function populateStationList() {
            const stationList = document.getElementById('station-list');
            if (!stationList) return;
            
            stationList.innerHTML = '';
            const stations = analysisData.station_analysis?.busiest_stations || [];
            
            stations.forEach(station => {
                const li = document.createElement('li');
                li.className = 'station-item';
                li.innerHTML = `
                    <div class="rank-badge">${station.rank}</div>
                    <div class="station-info">
                        <div class="station-name">${station.name_en}</div>
                        <div class="station-details">${station.operator} • ${station.railway} Line</div>
                    </div>
                    <div class="passenger-count">${station.daily_passengers.toLocaleString()}</div>
                `;
                stationList.appendChild(li);
            });
        }

        function createOperatorChart() {
            try {
                const canvas = document.getElementById('operatorChart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const operatorBreakdown = analysisData.station_analysis?.operator_breakdown;
                
                const operators = Object.keys(operatorBreakdown);
                const data = operators.map(op => operatorBreakdown[op].total_passengers);
                const labels = operators;
                
                operatorChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(118, 75, 162, 0.8)'
                            ],
                            borderWidth: 0,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.formattedValue;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.raw / total) * 100).toFixed(1);
                                        return `${label}: ${value} passengers (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
                console.log('✅ Operator chart created');
            } catch (error) {
                console.error('❌ Error creating operator chart:', error);
            }
        }

        function createPassengerChart() {
            try {
                const canvas = document.getElementById('passengerChart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const stations = analysisData.station_analysis?.busiest_stations;
                
                const labels = stations.map(s => s.name_en.replace(' Station', ''));
                const data = stations.map(s => s.daily_passengers);
                const colors = stations.map((_, index) => {
                    const hue = 240 + (index * 30);
                    return `hsla(${hue}, 70%, 60%, 0.8)`;
                });
                
                passengerChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Daily Passengers',
                            data: data,
                            backgroundColor: colors,
                            borderColor: colors.map(color => color.replace('0.8)', '1)')),
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    },
                                    font: {
                                        weight: '600',
                                        size: 10
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        weight: '600',
                                        size: 10
                                    }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.formattedValue} passengers`;
                                    }
                                }
                            }
                        }
                    }
                });
                console.log('✅ Passenger chart created');
            } catch (error) {
                console.error('❌ Error creating passenger chart:', error);
            }
        }

        function initMap() {
            try {
                const mapContainer = document.getElementById('map');
                if (!mapContainer || typeof L === 'undefined') {
                    console.log('⚠️ Map container or Leaflet not available');
                    return;
                }

                const stations = analysisData.station_analysis?.busiest_stations || [];
                if (stations.length === 0) {
                    console.log('⚠️ No station data available for map');
                    return;
                }

                map = L.map('map').setView([35.7006, 139.739], 11);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);

                stations.forEach(station => {
                    if (station.coordinates && station.coordinates.lat && station.coordinates.lng) {
                        const customIcon = L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background: linear-gradient(135deg, #667eea, #764ba2); width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">${station.rank}</div>`,
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        });

                        L.marker([station.coordinates.lat, station.coordinates.lng], {icon: customIcon})
                            .addTo(map)
                            .bindPopup(`<div style="font-family: Inter, sans-serif; padding: 8px;"><strong style="color: #667eea; font-size: 16px;">${station.name_en}</strong><br><span style="color: #64748b; font-size: 14px;">${station.name_jp || ''}</span><br><em style="color: #334155;">${station.operator} • ${station.railway}</em><br><strong style="color: #10b981;">Daily Passengers: ${station.daily_passengers.toLocaleString()}</strong></div>`);
                    }
                });

                setTimeout(() => {if (map) map.invalidateSize();}, 100);
                console.log('✅ Map initialized');
            } catch (error) {
                console.error('❌ Error initializing map:', error);
                const mapContainer = document.getElementById('map');
                if (mapContainer) {
                    mapContainer.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ef4444; font-weight: 600;">Map failed to load: ${error.message}</div>`;
                }
            }
        }

        function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            const icon = btn.querySelector('i');
            icon.style.animation = 'spin 1s linear infinite';
            btn.disabled = true;

            setTimeout(() => {
                // Simulate data refresh with slight variations
                const variation = Math.floor(Math.random() * 20000) - 10000;
                const currentValue = parseInt(document.getElementById('total-passengers').textContent.replace(/,/g, ''));
                const newValue = Math.max(0, currentValue + variation);
                document.getElementById('total-passengers').textContent = newValue.toLocaleString();

                const newPunctuality = (94.2 + (Math.random() - 0.5) * 3).toFixed(1);
                document.getElementById('punctuality').textContent = newPunctuality + '%';

                const newDelay = (1.0 + (Math.random() - 0.5) * 1.0).toFixed(1);
                document.getElementById('avg-delay').textContent = newDelay;

                // Update charts with new data
                if (passengerChart) {
                    const newData = analysisData.station_analysis.busiest_stations.map(s => {
                        const baseValue = s.daily_passengers;
                        const variation = Math.floor((Math.random() - 0.5) * baseValue * 0.1);
                        return Math.max(0, baseValue + variation);
                    });
                    passengerChart.data.datasets[0].data = newData;
                    passengerChart.update('none');
                }

                showNotification('✅ Data refreshed successfully!');
                
                icon.style.animation = '';
                btn.disabled = false;
            }, 1500);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 30px; right: 30px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px 28px; border-radius: 16px; box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3); z-index: 1000; font-weight: 600; transform: translateX(400px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);';
            
            if (message.includes('❌')) {
                notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                notification.style.boxShadow = '0 20px 60px rgba(239, 68, 68, 0.3)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => notification.remove(), 400);
            }, 3000);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initDashboard);
        if (document.readyState !== 'loading') initDashboard();

        // Handle window resize for map
        window.addEventListener('resize', function() {
            if (map) setTimeout(() => map.invalidateSize(), 100);
        });
    </script>