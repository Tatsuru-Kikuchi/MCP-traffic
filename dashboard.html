        }

        function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            const icon = btn.querySelector('i');
            
            icon.style.animation = 'spin 1s linear infinite';
            btn.disabled = true;
            
            setTimeout(() => {
                icon.style.animation = '';
                btn.disabled = false;
                
                // Update metrics with random variations
                const variation = Math.floor(Math.random() * 20000) - 10000;
                const currentValue = parseInt(document.getElementById('total-passengers').textContent.replace(/,/g, ''));
                const newValue = Math.max(0, currentValue + variation);
                document.getElementById('total-passengers').textContent = newValue.toLocaleString();
                
                const newPunctuality = (94.2 + (Math.random() - 0.5) * 3).toFixed(1);
                document.getElementById('punctuality').textContent = newPunctuality + '%';
                
                const newDelay = (1.0 + (Math.random() - 0.5) * 1.0).toFixed(1);
                document.getElementById('avg-delay').textContent = newDelay;
                
                // Update charts with new data
                if (passengerChart) {
                    const newData = sampleData.stations.map(s => {
                        const baseValue = s.daily_passengers;
                        const variation = Math.floor((Math.random() - 0.5) * baseValue * 0.1);
                        return Math.max(0, baseValue + variation);
                    });
                    
                    passengerChart.data.datasets[0].data = newData;
                    passengerChart.update('none');
                }
                
                showNotification('âœ… Data refreshed successfully!');
            }, 1500);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 20px 28px;
                border-radius: 16px;
                box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3);
                z-index: 1000;
                font-weight: 600;
                transform: translateX(400px);
                transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => notification.remove(), 400);
            }, 3000);
        }

        // Initialize dashboard when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            initDashboard();
        });

        // Fallback initialization if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDashboard);
        } else {
            initDashboard();
        }

        // Handle window resize for map
        window.addEventListener('resize', function() {
            if (map) {
                setTimeout(() => {
                    map.invalidateSize();
                }, 100);
            }
        });
    </script>
</body>
</html>